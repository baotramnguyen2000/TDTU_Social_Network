<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= target.name %></title>
    <!--navbar-->
    <link rel="stylesheet" type="text/css" href="stylesheet/style.css">
    <link rel="icon" type="image/png" href="https://iconarchive.com/download/i85627/graphicloads/100-flat/student.ico">

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" integrity="sha512-iBBXm8fW90+nuLcSKlbmrPcLa0OT92xO1BIsZ+ywDWZCvqsWgccV3gFoRBv0z+8dLJgyAHIhR35VZc2oM/gI1w==" crossorigin="anonymous" />	
    <script src="https://cdn.tiny.cloud/1/6qusxwrsagjvgmmmqqtq8wk1w4e5fyvyl3nmrgtotg7tx6va/tinymce/5/tinymce.min.js" referrerpolicy="origin"></script>    
    <link href="http://www.jqueryscript.net/demo/jQuery-Plugin-For-Multi-Select-List-with-Checkboxes-MultiSelect/jquery.multiselect.css" rel="stylesheet" type="text/css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.js" integrity="sha512-n/4gHW3atM3QqRcbCn6ewmpxcLAHGaDjpEBu4xZd47N0W2oQ+6q7oc3PXstrJYXcbNU1OHdQ1T7pAP+gi5Yu8g==" crossorigin="anonymous"></script>    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
    <script src="http://www.jqueryscript.net/demo/jQuery-Plugin-For-Multi-Select-List-with-Checkboxes-MultiSelect/jquery.multiselect.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js" integrity="sha512-q/dWJ3kcmjBLU4Qc47E4A9kTB4m3wuTY7vkFJDTZKjTs8jhyGQnaUrxa0Ytd0ssMZhbNua9hE+E7Qv1j+DyZwA==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/notify/0.4.2/notify.min.js" integrity="sha512-efUTj3HdSPwWJ9gjfGR71X9cvsrthIA78/Fvd/IN+fttQVy7XWkOAXb295j8B3cmm/kFKVxjiNYzKw9IQJHIuQ==" crossorigin="anonymous"></script>
    <script src="https://cdn.datatables.net/1.10.24/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.10.24/js/dataTables.bootstrap4.min.js"></script>
    <script src="https://cdn.datatables.net/responsive/2.2.7/js/dataTables.responsive.min.js"></script>
    <script src="https://cdn.datatables.net/responsive/2.2.7/js/responsive.bootstrap4.min.js"></script>
    <script src="/javascripts/main.js"></script>
		<script>

			tinymce.init({
			  selector: ".tiny",
			  plugins: "emoticons",
			  plugins: [
			  'advlist autolink lists link image charmap print preview anchor',
			  'searchreplace visualblocks code fullscreen',
			  'insertdatetime media table paste code help wordcount'
			  ],
			  toolbar: 'undo redo | formatselect | ' +
			  'bold italic backcolor | alignleft aligncenter ' +
			  'alignright alignjustify | bullist numlist outdent indent | ' +
			  'removeformat | help',
			  content_style: 'body { font-family:Helvetica,Arial,sans-serif; font-size:14px }'
		   })
		   
		  </script>
    <!---->

    
   
</head>
<body>
        <nav class="navbar navbar-expand-lg navbar-light bg-light">
              <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavDropdown" aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
              </button>
              <div class="collapse navbar-collapse" id="navbarNavDropdown">
                <ul class="navbar-nav">
                  <li class="nav-item">
                    <a class="nav-link active" aria-current="page" href="/dashboard">Trang chủ</a>
                  </li>


                  <li class="nav-item dropdown active" style="float: right;">
                    <a class="nav-link dropdown-toggle" href="#" id="navbarDropdownMenuLink" role="button" data-toggle="dropdown" aria-expanded="false">
                      <img class="rounded mr-3" src="<%= user.avatar %> " width="40"><%= user.name %>
                    </a>
                    <ul class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
                        <li><a class="dropdown-item" href="#" data-toggle="modal" data-target="#edit">Chỉnh sửa thông tin</a></li>
                      <div class="dropdown-divider"></div>
                      <li><a class="dropdown-item" href="/login/logout">Đăng xuất  <i class="fas fa-sign-out-alt" style="color: brown;"></i></a></li>
                      <% if (user.role == 'admin') {%> 
                        <div class="dropdown-divider"></div>
                        <li><a class="dropdown-item" href="/login/register">Tạo tài khoản</a></li>
                      <% } %> 
                    </ul>
                  </li>
                  <% if(user.role == 'student') { %> 
                  <button type="button" data-toggle="modal" data-target="#myModal" class="btn btn-sm btn-info ">
                    <span aria-hidden="true"> <i class="fas fa-plus fa-sm"></i> Tạo bài viết</span>
                  </button>
                  <% } else { %> 
                  <button type="button" data-toggle="modal" data-target="#khoa" class="btn btn-sm btn-info ">
                    <span aria-hidden="true"> <i class="fas fa-plus fa-sm"></i> Tạo thông báo</span>
                  </button>
                  <% } %> 
                </ul>
              </div>
          </nav>


    <!-- Modal -->
    <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" style="text-align: center; font-weight: bold; font-size: 30px;">Tạo bài viết</h5>
            </div>
            <div class="modal-body">
                <form>
                    <textarea name="postcontent" id="postcontent" style="border-radius: initial;border: none;outline: none;" class="form-control input-lg p-text-area tiny" rows="2" placeholder="Whats in your mind today?"></textarea>
                    <div class="modal-footer">
                      <button type="button" onclick="postdashboard()" data-dismiss="modal" class="btn btn-primary">Đăng bài viết</button>
                      <button type="button" class="btn btn-secondary" data-dismiss="modal">Hủy</button>
                    </div>
                </form>
            </div>
            
          </div>
        </div>
      </div>
    <!-- Modal -->
    <!-- Khoa Modal -->
<div class="modal fade bd-example-modal-lg" id="khoa" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog modal-lg" role="document">
      <div class="modal-content">
        <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLabel">Chọn phòng khoa</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <form>
              <div class="form-group">
                <label for="recipient-name" class="col-form-label">Tiêu đề:</label>
                <input name="title" id="NotifTitle" type="text" class="form-control">
              </div>

              <div class="form-group">
                <label for="recipient-name" class="col-form-label">Nội dung:</label>
                <input id="NotifContent" name="content" type="text" class="form-control">
              </div>

             
              <div class="form-group">
                <h5>Danh sách khoa:</h5>
                <select id="falcuty" name="falcuty" class="form-control">
                  <option value="KHOA HỌC THỂ THAO">Khoa học thể thao</option>
                  <option value="KHOA HỌC ỨNG DỤNG">Khoa học ứng dụng</option>
                  <option value="KHOA HỌC XÃ HỘI VÀ NHÂN VĂN">Khoa học xã hội & nhân văn</option>
                  <option value="CÔNG NGHỆ THÔNG TIN">Công nghệ thông tin</option>
                  <option value="ĐIỆN - ĐIỆN TỬ">Điện - Điện tử</option>
                  <option value="TOÁN - THỐNG KÊ">Toán - Thống kê</option>
                  <option value="MỸ THUẬT CÔNG NGHIỆP">Mỹ thuật công nghiệp</option>
                  <option value="KỸ THUẬT CÔNG TRÌNH">Kỹ thuật công trình</option>
                  <option value="DƯỢC">Dược</option>
                  <option value="LUẬT">Luật</option>
                  <option value="NGOẠI NGỮ">Ngoại ngữ</option>
                  <option value="QUẢN TRỊ KINH DOANH">Quản trị kinh doanh</option>
                  <option value="KẾ TOÁN">Kế toán</option>
                  <option value="TÀI CHÍNH NGÂN HÀNG">Tài chính ngân hàng</option>
                  <option value="MÔI TRƯỜNG VÀ BẢO HỘ LAO ĐỘNG">Môi trường và bảo hộ lao động</option>
                  <option value="LAO ĐỘNG VÀ CÔNG ĐOÀN">Lao động và công đoàn</option>
                </select>
              </div>
              <div class="modal-footer">
                <button type="button" data-dismiss="modal" id="sendNotif" onclick="sendMessage()" class="btn btn-primary">Lưu</button>
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Hủy</button>
              </div>
            </form>
          </div>
      </div>
    </div>
</div>
<!-- End Khoa Modal -->


<!-- Edit Modal -->
<div class="modal fade bd-example-modal-lg" id="edit" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog modal-lg" role="document">
      <div class="modal-content">
        <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLabel">Cập nhật thông tin</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <form>
              <div class="form-group">
                <label for="recipient-name" class="col-form-label">Tên hiển thị:</label>
                <input type="text" class="form-control" value="<%= user.name %> " id="name">
              </div>

              <div class="form-group">
                <label for="recipient-name" class="col-form-label">Lớp:</label>
                <input type="text" class="form-control" value="<%= user.class %> " id="class">
              </div>

              <div class="form-group">
                <label for="recipient-name" class="col-form-label">Khoa:</label>
                <input type="text" class="form-control" value="<%= user.falcuty %> " id="falcuty">
              </div>

              <div class="form-group">
                <label for="recipient-name" class="col-form-label">Ảnh đại diện:</label>
                <input type="text" class="form-control" value="<%= user.avatar %> " id="avatar">
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button type="button" id="editAccount" data-id="<%= user._id %>" data-dismiss="modal" class="btn btn-primary">Lưu</button>
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Hủy</button>
          </div>
      </div>
    </div>
</div>
<!-- End Edit Modal -->

    <div class="container-fluid">
        <div class="row">
            <div class="col-lg-12 p-3">
                <!-- <div class="card mt-3 bg-light">
                    <div class="card-header text-center">
                        <h5>BÀI ĐĂNG MỚI</h5>
                    </div>
                </div> -->
                <% if (posts) { posts = posts.reverse(); posts.forEach((post, index) => { %>
                    <% if(target) { %> 
                    <% if(post.Owner == target.name) { %> 
                <div class="card mt-3 bg-light">
                  <% if(user.name == post.Owner) { %>
                  <!--Dropdown edit, delete-->
                  <div class="card-header">
                    <div class="dropdown float-right" data-display="static" >
                      <i class="fas fa-ellipsis-h" id="dropdownMenuLink" style="cursor: pointer;" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"></i>

                    
                      <div class="dropdown-menu dropdown-menu-right" aria-labelledby="dropdownMenuLink">
                        <a class="dropdown-item" id="post-update" data-id="<%= post._id %>">Chỉnh sửa bài viết</a>
                        <a class="dropdown-item" id="post-delete" data-id="<%= post._id %>">Xóa bài viết</a>
                      </div>
                    </div>
                  </div>
                  <!-- MODAL DELETE -->
                  <div class="modal fade" id="confirm-delete-dialog" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                    <div class="modal-dialog" role="document">
                      <div class="modal-content">
                        <div class="modal-header">
                          <h5 class="modal-title" id="del_postLabel">Xóa bài viết</h5>
                          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                          </button>
                        </div>
                        <div class="modal-body">
                          Bạn có chắc rằng muốn xóa bài viết này?
                        </div>
                        <div class="modal-footer">
                          <button type="button" class="btn btn-secondary" data-dismiss="modal">Hủy</button>
                          <button type="button" data-id="???" id="btn-delete-confirmed" class="btn btn-primary">Xóa</button>
                        </div>
                      </div>
                    </div>
                  </div>
                  <% } %>
                <!--Dropdown edit, delete-->
                <!--Update Modal-->
                <div class="modal fade" id="modalUpdate" tabindex="-1" role="dialog" aria-labelledby="PostUpdateModal">
                  <div class="modal-dialog" role="document">
                    <div class="modal-content">
                      <div class="modal-header">
                        <h5 class="modal-title" style="text-align: center; font-weight: bold; font-size: 30px;">Tạo bài viết</h5>
                      </div>
                      <div class="modal-body">
                          <form>
                              <textarea value="<%= post.content %> " name="updatecontent" id="updatecontent" style="border-radius: initial;border: none;outline: none;" class="form-control input-lg p-text-area tiny" rows="2" placeholder="Whats in your mind today?"></textarea>
                              <div class="modal-footer">
                                <button type="button" data-id="<%= post._id %> " id="update-confirmed" class="btn btn-primary">Đăng bài viết</button>
                                <button type="button" class="btn btn-secondary" data-dismiss="modal">Hủy</button>
                              </div>
                          </form>
                      </div>
                      
                    </div>
                  </div>
                </div>
                <!--Update Modal-->
                
                    <div class="card-body">
                      <h6 class="card-title" ><a href="/dashboard/<%- post.Owner %>"><%- post.Owner %> </a>
                          <p class="card-text"><small class="text-muted"><%= post.createAt %> </small></p>
                      </h6>
                      <input type="hidden" id="postId" value="<%= post._id %>">
                      <h6 class="card-subtitle mb-2 text-muted"></h6>
                      <p class="card-text" ><%- post.content %> </p>
                        <div class="bg-white p-2">
                            <div class="d-flex flex-row fs-12">
                                <!-- <div class="like p-2 cursor"><i class="far fa-thumbs-up"></i><span class="ml-1" style="cursor: pointer;"><%= post.Likes %>  lượt Thích </span></div> -->
                                <div class="like p-2 cursor action-collapse" data-toggle="collapse" aria-expanded="true" aria-controls="collapse-1<%= post._id %>" href="#collapse-1<%= post._id %>"><i class="far fa-comment"></i><span class="ml-1"  style="cursor: pointer;">Bình luận</span></div>
                            </div>
                        </div>	
                        <div id="collapse-1<%= post._id %>" class="bg-light p-2 collapse" data-parent="#myGroup">
                            <div class="d-flex flex-row align-items-start"><img class="rounded-circle" src="<%= user.avatar %>" width="40">
                                <input id="Comment <%= post._id %>" class="form-control ml-1 shadow-none "></input>
                                <input type="hidden" id="input-comment" value="Comment <%= post._id %>"  >
                            </div>
                            <div class="mt-2 text-right"><button class="btn btn-primary btn-sm shadow-none" onclick="postComment();" type="button">Gửi bình luận</button><button class="btn btn-outline-primary btn-sm ml-1 shadow-none" type="button">Hủy</button></div>
                            <br>
                            <ul id="<%= post._id %>" class="fb-comments" style="width:100%;">
                                <% if (comments) { comments.forEach((comment) => { %>
                                    <% if(comment.PostId == post._id) { %> 
                                        <li class="list-group-item mt-3" id="<%= comment._id %>">
                                            <h6 class="card-title" ><%= comment.Owner %> 
                                                <p class="card-text"><small class="text-muted"><%= comment.createAt %> </small></p>
                                            </h6>
                                            <h6 class="card-subtitle mb-2 text-muted"></h6>
                                            <p class="card-text" ><%= comment.content %> </p>
                                            <% if(user.name == comment.Owner) { %>
                                            <div class="card-footer text-muted" style="text-align: right;">
                                                <button type="button" id="commentdelete" data-id="<%= comment._id %>" class="btn btn-danger btn-sm"><i class="far fa-trash-alt"></i></button>
                                            </div>
                                            <% } %>
                                        </li>
                                    <% } %>
                                <% }) } %>
                            </ul>
                        </div>
                    </div>
                </div>
                <% }} %> 
                <% }) } %>
            </div>
        </div>
        
    </div>
    
  </body>
</html>